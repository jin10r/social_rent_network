#!/bin/bash

# ==========================================
# –°–ö–†–ò–ü–¢ –û–°–¢–ê–ù–û–í–ö–ò –í–°–ï–• –°–ï–†–í–ò–°–û–í
# ==========================================
# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

set -e

echo "üõë Social Rent App - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤"
echo "============================================"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
if docker-compose -f docker-compose.remote.yml ps | grep -q "Up"; then
    docker-compose -f docker-compose.remote.yml down
    echo "‚úÖ –°–µ—Ä–≤–∏—Å—ã —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚ÑπÔ∏è  –°–µ—Ä–≤–∏—Å—ã —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
if docker-compose -f docker-compose.frontend.yml ps | grep -q "Up"; then
    docker-compose -f docker-compose.frontend.yml down
    echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ÑπÔ∏è  –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –æ—á–∏—Å—Ç–∫–∞ volumes (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
echo
read -p "üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ volumes..."
    docker-compose -f docker-compose.remote.yml down -v
    echo "‚úÖ Volumes —É–¥–∞–ª–µ–Ω—ã"
fi

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –æ—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–∑–æ–≤ (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
echo
read -p "üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å Docker –æ–±—Ä–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤..."
    docker images | grep social_rent | awk '{print $3}' | xargs -r docker rmi
    echo "‚úÖ –û–±—Ä–∞–∑—ã —É–¥–∞–ª–µ–Ω—ã"
fi

echo
echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
echo
echo "üìù –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "  ./scripts/start-remote.sh   # –£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä"
echo "  ./scripts/start-frontend.sh # –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥"