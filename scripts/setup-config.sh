#!/bin/bash

# ==========================================
# –°–ö–†–ò–ü–¢ –ù–ê–°–¢–†–û–ô–ö–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ==========================================
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

set -e

echo "üöÄ Social Rent App - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "üìã –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    cp .env.central .env
    echo "‚úÖ –§–∞–π–ª .env —Å–æ–∑–¥–∞–Ω"
else
    echo "‚ö†Ô∏è  –§–∞–π–ª .env —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    read -p "–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        cp .env.central .env
        echo "‚úÖ –§–∞–π–ª .env –æ–±–Ω–æ–≤–ª–µ–Ω"
    fi
fi

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
echo
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:"
echo

read -p "–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞): " bot_token
if [ ! -z "$bot_token" ]; then
    sed -i "s/BOT_TOKEN=.*/BOT_TOKEN=$bot_token/" .env
    echo "‚úÖ BOT_TOKEN –æ–±–Ω–æ–≤–ª–µ–Ω"
fi

read -p "–í–≤–µ–¥–∏—Ç–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (https://12345.ngrok-free.app): " webapp_url
if [ ! -z "$webapp_url" ]; then
    sed -i "s|WEBAPP_URL=.*|WEBAPP_URL=$webapp_url|" .env
    echo "‚úÖ WEBAPP_URL –æ–±–Ω–æ–≤–ª–µ–Ω"
fi

read -p "–í–≤–µ–¥–∏—Ç–µ URL backend —Å–µ—Ä–≤–µ—Ä–∞ (http://your-ip:8001): " backend_url  
if [ ! -z "$backend_url" ]; then
    sed -i "s|BACKEND_URL=.*|BACKEND_URL=$backend_url|" .env
    echo "‚úÖ BACKEND_URL –æ–±–Ω–æ–≤–ª–µ–Ω"
fi

read -p "–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è CORS (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é): " allowed_origins
if [ ! -z "$allowed_origins" ]; then
    sed -i "s|ALLOWED_ORIGINS=.*|ALLOWED_ORIGINS=$allowed_origins|" .env
    echo "‚úÖ ALLOWED_ORIGINS –æ–±–Ω–æ–≤–ª–µ–Ω"
fi

echo
echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!"
echo "üìù –§–∞–π–ª .env –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
echo
echo "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env —Ñ–∞–π–ª–µ"
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –∫–æ–º–∞–Ω–¥–æ–π:"
echo "   ./scripts/start-remote.sh  # –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞"
echo "   ./scripts/start-frontend.sh  # –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"